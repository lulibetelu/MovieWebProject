<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Perfil de <%= user.username %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.2.2/dist/full.css" rel="stylesheet">
    <style>
        body {
            background-color: #0a0a0a;
            color: white;
            font-family: 'Inter', sans-serif;
        }
        .accent-orange { color: #ff7b00; }
        .soft-yellow { color: #ffdd7d; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start p-6">

<!-- header -->
<div class="text-center mb-12">
    <h1 class="text-5xl font-bold mb-2">
        <span class="accent-orange"><%= user.username %></span>
    </h1>
    <p class="text-gray-400"><%= user.email %></p>
</div>

<!-- cantidad de peliculas rateadas y reviewed -->
<div class="grid grid-cols-2 gap-8 text-center mb-16 max-w-3xl w-full">
    <div class="p-6 rounded-2xl bg-gradient-to-b from-[#ff7b00] to-[#ffb347] shadow-lg transform hover:scale-105 transition duration-300">
        <h3 id="ratedMovies" class="text-4xl font-bold text-black">0</h3>
        <p class="mt-2 text-sm text-black font-semibold">Películas calificadas</p>
    </div>
    <div class="p-6 rounded-2xl bg-gradient-to-b from-[#ffdd7d] to-[#ffd24c] shadow-lg transform hover:scale-105 transition duration-300">
        <h3 id="writtenReviews" class="text-4xl font-bold text-black">0</h3>
        <p class="mt-2 text-sm text-black font-semibold">Reseñas escritas</p>
    </div>
</div>

<!-- recientes -->
<div class="w-full max-w-5xl space-y-16">

    <!-- peliculas rateadas -->
    <section>
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold accent-orange">Últimas películas calificadas</h2>
            <a href="/rated" class="text-sm soft-yellow hover:text-white transition">Ver todas →</a>
        </div>
        <% if (user.lastRated && user.lastRated.length > 0) { %>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4">
                <% user.lastRated.forEach(movie => { %>
                    <div class="bg-[#1a1a1a] rounded-xl overflow-hidden shadow-lg hover:scale-105 transition">
                        <a href="/pelicula/<%= movie.movie_id %>">
                            <% if (movie.poster_path) { %>
                                <img src="<%= movie.poster_path %>" alt="<%= movie.title %>" class="w-full h-48 object-cover">
                            <% } else { %>
                                <div class="w-full h-48 bg-gray-800 flex items-center justify-center text-gray-400 text-sm">Sin imagen</div>
                            <% } %>
                            <div class="p-3">
                                <p class="text-white font-semibold text-sm truncate"><%= movie.title %></p>
                                <div class="rating-sm ">
                                    <input type="radio" name="rating-<%= movie.movie_id %>" class="mask mask-star" aria-label="1 star" />
                                    <input type="radio" name="rating-<%= movie.movie_id %>" class="mask mask-star" aria-label="2 star" checked="checked" />
                                    <input type="radio" name="rating-<%= movie.movie_id %>" class="mask mask-star" aria-label="3 star" />
                                    <input type="radio" name="rating-<%= movie.movie_id %>" class="mask mask-star" aria-label="4 star" />
                                    <input type="radio" name="rating-<%= movie.movie_id %>" class="mask mask-star" aria-label="5 star" />

                                </div>
                            </div>
                        </a>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <p class="text-gray-500 italic">Todavía no calificaste ninguna película.</p>
        <% } %>
    </section>

    <!-- reviews -->
    <section>
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold soft-yellow">Últimas reseñas</h2>
            <a href="/reviews" class="text-sm accent-orange hover:text-white transition">Ver todas →</a>
        </div>
        <% if (user.lastReviews && user.lastReviews.length > 0) { %>
            <div class="space-y-4">
                <% user.lastReviews.forEach(review => { %>
                    <div class="bg-[#1a1a1a] p-5 rounded-xl border border-[#ff7b00]/20 hover:border-[#ff7b00]/40 transition">
                        <a href="/pelicula/<%= review.movie_id %>" class="text-lg font-semibold accent-orange hover:underline"><%= review.title %></a>
                        <p class="text-gray-300 mt-2 italic">“<%= review.text %>”</p>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <p class="text-gray-500 italic">Todavía no escribiste ninguna reseña.</p>
        <% } %>
    </section>

</div>

<!-- botones -->
<div class="mt-16 flex justify-center gap-4">
    <a href="/buscar?q=" class="btn bg-transparent border-[#ff7b00] text-[#ff7b00] hover:bg-[#ff7b00] hover:text-black transition">Volver al inicio</a>
    <a href="/logout" class="btn bg-[#ff7b00] text-black hover:bg-[#ffdd7d] hover:text-black border-none transition">Cerrar sesión</a>
</div>

<script>
    // Contadores animados
    function animateCounter(id, target) {
        const el = document.getElementById(id);
        let count = 0;

        const steps = 300;
        const increment = Math.ceil(target / steps);

        const interval = setInterval(() => {
            count += increment;
            if (count >= target) {
                count = target;
                clearInterval(interval);
            }
            el.textContent = Math.floor(count);
        }, 35);
    }

    document.addEventListener('DOMContentLoaded', () => {
        animateCounter('ratedMovies', <%= user.ratedMovies %>);
        animateCounter('writtenReviews', <%= user.writtenReviews %>);
    });
</script>
</body>
</html>
